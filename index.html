<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dual DGX Spark â€” Coding Agent Blueprint v2.2</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=Outfit:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg:#06060a;--s1:#0e0e14;--s2:#14141c;--card:#161620;
  --brd:#1e1e2a;--brd2:#2a2a3a;
  --t0:#f2f2f8;--t1:#c4c4d4;--t2:#8888a0;--t3:#555568;
  --grn:#00e68a;--blu:#4d94ff;--red:#ff5c6e;--amb:#ffb84d;--pur:#b08cff;--cyn:#00d4ff;
  --grn-g:rgba(0,230,138,.06);--red-g:rgba(255,92,110,.06);--amb-g:rgba(255,184,77,.06);
}
body{background:var(--bg);color:var(--t0);font-family:'Outfit',system-ui,sans-serif;line-height:1.6;-webkit-font-smoothing:antialiased}
code,.mono{font-family:'JetBrains Mono',monospace;font-size:12px}
::-webkit-scrollbar{width:5px}::-webkit-scrollbar-thumb{background:var(--brd2);border-radius:4px}
.wrap{max-width:960px;margin:0 auto;padding:28px 20px 80px}

/* â•â•â• HERO â•â•â• */
.hero{text-align:center;padding:40px 0 28px;position:relative}
.hero::before{content:'';position:absolute;top:-20px;left:50%;transform:translateX(-50%);width:600px;height:350px;background:radial-gradient(ellipse,rgba(0,230,138,.06) 0%,rgba(77,148,255,.04) 40%,transparent 70%);pointer-events:none}
.chip{display:inline-flex;align-items:center;gap:7px;background:linear-gradient(135deg,rgba(0,230,138,.1),rgba(77,148,255,.08));border:1px solid rgba(0,230,138,.2);border-radius:999px;padding:5px 16px;font-size:11px;color:var(--grn);font-weight:600;letter-spacing:.5px;text-transform:uppercase;margin-bottom:14px}
.chip .pulse{width:7px;height:7px;border-radius:50%;background:var(--grn);animation:pulse 2s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.25}}
.hero h1{font-size:clamp(24px,5vw,36px);font-weight:800;letter-spacing:-.5px;background:linear-gradient(135deg,#fff 40%,var(--grn) 90%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:8px}
.hero p{color:var(--t2);font-size:14px;max-width:640px;margin:0 auto}
.hero-tags{display:flex;justify-content:center;gap:14px;margin-top:14px;flex-wrap:wrap}
.hero-tag{font-size:11px;color:var(--t3);display:flex;align-items:center;gap:4px}

/* â•â•â• SPECS â•â•â• */
.specs{display:grid;grid-template-columns:repeat(6,1fr);gap:8px;margin-bottom:24px}
.spec{background:var(--card);border:1px solid var(--brd);border-radius:12px;padding:12px 8px;text-align:center;transition:all .2s}
.spec:hover{border-color:var(--brd2);transform:translateY(-2px)}
.spec .emoji{font-size:18px;margin-bottom:3px}
.spec .val{font-size:16px;font-weight:700;font-family:'JetBrains Mono',monospace}
.spec .lbl{font-size:9px;color:var(--t3);text-transform:uppercase;letter-spacing:.5px;margin-top:1px}

/* â•â•â• NAV â•â•â• */
.nav{display:flex;gap:3px;background:var(--s1);border:1px solid var(--brd);border-radius:12px;padding:4px;margin-bottom:24px;position:sticky;top:8px;z-index:100;backdrop-filter:blur(16px)}
.nav button{flex:1;padding:10px 4px;border:none;border-radius:8px;background:transparent;color:var(--t2);font-family:'Outfit',sans-serif;font-size:12px;font-weight:600;cursor:pointer;transition:all .2s;white-space:nowrap}
.nav button.on{background:var(--card);color:var(--t0);box-shadow:0 2px 10px rgba(0,0,0,.4)}
.nav button:hover:not(.on){color:var(--t1)}

/* â•â•â• SECTIONS â•â•â• */
.sec{display:none}.sec.vis{display:block;animation:fadeIn .25s ease}
@keyframes fadeIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}

/* â•â•â• PHASE HEADER â•â•â• */
.ph-hdr{display:flex;align-items:center;gap:14px;margin-bottom:6px}
.ph-icon{width:44px;height:44px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:22px;flex-shrink:0}
.ph-info h2{font-size:17px;font-weight:700;letter-spacing:-.2px}
.ph-info p{font-size:12px;color:var(--t2);margin-top:2px;line-height:1.5}

/* â•â•â• PROGRESS â•â•â• */
.prog-wrap{display:flex;align-items:center;gap:12px;margin:10px 0 16px}
.prog-bar{flex:1;height:6px;background:var(--s1);border-radius:3px;overflow:hidden}
.prog-fill{height:100%;border-radius:3px;transition:width .35s ease}
.prog-text{font-size:13px;font-weight:700;font-family:'JetBrains Mono',monospace;min-width:55px;text-align:right}

/* â•â•â• SPARK LAYOUT â•â•â• */
.spark-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:14px}
.spark-card{background:var(--card);border-radius:12px;padding:14px;border:1px solid}
.spark-card h4{font-size:12px;font-weight:700;margin-bottom:8px;display:flex;align-items:center;gap:6px}
.spark-card .badge{font-size:9px;color:var(--t3);margin-left:auto;background:var(--s1);padding:2px 7px;border-radius:5px}
.si{font-size:12px;color:var(--t1);padding:2px 0;display:flex;align-items:center;gap:6px}
.si .arr{font-size:10px;font-weight:700;width:14px;text-align:center;flex-shrink:0}

/* â•â•â• TRACK (checklist group) â•â•â• */
.track{background:var(--card);border:1px solid var(--brd);border-radius:12px;margin-bottom:10px;overflow:hidden}
.track-head{padding:10px 16px;font-size:13px;font-weight:700;border-bottom:1px solid var(--brd);display:flex;align-items:center;gap:8px;cursor:pointer;user-select:none;transition:background .15s}
.track-head:hover{background:rgba(255,255,255,.015)}
.track-head .left{display:flex;align-items:center;gap:8px;flex:1}
.track-head .tag{font-size:9px;padding:2px 7px;border-radius:5px;font-weight:600;letter-spacing:.3px;text-transform:uppercase}
.track-head .counter{font-size:11px;color:var(--t3);font-family:'JetBrains Mono',monospace}
.track-head .chevron{color:var(--t3);font-size:14px;margin-left:8px}
.track-body{transition:max-height .3s ease}
.track-body.hide{display:none}

/* â•â•â• TASK ROW (checkbox) â•â•â• */
.task{display:flex;align-items:flex-start;gap:12px;padding:9px 16px;cursor:pointer;transition:background .12s;border-bottom:1px solid rgba(30,30,42,.5)}
.task:last-child{border-bottom:none}
.task:hover{background:rgba(30,30,42,.35)}
.task.done{opacity:.55}
.cb{width:18px;height:18px;border:2px solid var(--brd2);border-radius:5px;flex-shrink:0;margin-top:1px;display:flex;align-items:center;justify-content:center;transition:all .2s;font-size:10px;color:transparent;font-weight:700}
.task.done .cb{border-color:var(--grn);background:rgba(0,230,138,.12);color:var(--grn)}
.task-body{flex:1;min-width:0}
.task-text{font-size:13px;line-height:1.45;transition:all .2s}
.task.done .task-text{text-decoration:line-through;color:var(--t3)}
.task-cmd{font-size:11px;color:var(--t3);font-family:'JetBrains Mono',monospace;margin-top:3px;background:rgba(0,0,0,.35);padding:3px 8px;border-radius:5px;display:inline-block;word-break:break-all;transition:opacity .2s}
.task.done .task-cmd{opacity:.4}

/* â•â•â• GOV GRID â•â•â• */
.gov{display:grid;grid-template-columns:1fr 1fr;gap:6px;margin:8px 0}
.gov-cell{background:var(--s1);border:1px solid var(--brd);border-radius:8px;padding:8px 10px}
.gov-cell .gl{font-size:9px;color:var(--t3);text-transform:uppercase;letter-spacing:.4px;margin-bottom:2px}
.gov-cell .gv{font-size:11px;font-weight:600;color:var(--t1);font-family:'JetBrains Mono',monospace}

/* â•â•â• SUCCESS â•â•â• */
.success{background:var(--grn-g);border:1px solid rgba(0,230,138,.15);border-radius:12px;padding:14px 16px;margin-top:12px}
.success h4{font-size:11px;color:var(--grn);font-weight:700;text-transform:uppercase;letter-spacing:.5px;margin-bottom:8px}
.success .si{color:var(--t1);font-size:12px}
.success .si .arr{color:var(--grn)}

/* â•â•â• WARN â•â•â• */
.warn{background:var(--amb-g);border:1px solid rgba(255,184,77,.15);border-radius:10px;padding:12px 14px;margin:10px 0}
.warn h4{font-size:10px;color:var(--amb);font-weight:700;text-transform:uppercase;letter-spacing:.4px;margin-bottom:6px}
.warn p{font-size:12px;color:var(--t1);line-height:1.5}
.danger{background:var(--red-g);border:1px solid rgba(255,92,110,.15);border-radius:10px;padding:12px 14px;margin:10px 0}
.danger h4{font-size:10px;color:var(--red);font-weight:700;text-transform:uppercase;letter-spacing:.4px;margin-bottom:6px}
.danger .si{font-size:12px}

/* â•â•â• TABLE â•â•â• */
.tbl{width:100%;border-collapse:collapse;font-size:11px;margin:10px 0}
.tbl th{text-align:left;padding:7px 8px;background:var(--s1);color:var(--t2);font-weight:600;font-size:9px;text-transform:uppercase;letter-spacing:.4px;border-bottom:1px solid var(--brd)}
.tbl td{padding:7px 8px;border-bottom:1px solid rgba(30,30,42,.5);color:var(--t1)}

/* â•â•â• RAM BAR â•â•â• */
.ram-row{display:flex;align-items:center;gap:8px;margin-bottom:4px}
.ram-lbl{width:150px;font-size:11px;color:var(--t1);flex-shrink:0}
.ram-bg{flex:1;height:18px;background:var(--s1);border-radius:4px;overflow:hidden;border:1px solid var(--brd)}
.ram-fill{height:100%;border-radius:3px;display:flex;align-items:center;justify-content:flex-end;padding-right:6px;min-width:28px}
.ram-fill span{font-size:9px;font-family:'JetBrains Mono',monospace;color:#fff;font-weight:600}

/* â•â•â• QUICKSTART â•â•â• */
.qs{background:var(--grn-g);border:1px solid rgba(0,230,138,.15);border-radius:12px;padding:16px;margin-top:14px}
.qs h3{color:var(--grn);font-weight:700;font-size:14px;margin-bottom:12px}
.qs-cmd{background:var(--bg);border-radius:8px;padding:10px 12px;margin-bottom:6px}
.qs-cmd code{font-size:11px;color:var(--grn);white-space:pre-wrap;line-height:1.7}
.qs .tip{font-size:11px;color:var(--t3);margin-top:10px;line-height:1.5}

@media(max-width:768px){.specs{grid-template-columns:repeat(3,1fr)}.spark-grid,.gov{grid-template-columns:1fr}.nav button{font-size:10px;padding:8px 3px}}
@media(max-width:480px){.specs{grid-template-columns:repeat(2,1fr)}}
</style>
</head>
<body>
<div class="wrap" id="app"></div>
<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• DATA â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const P=[
// â•â•â• FAZ 0 â•â•â•
{id:0,emoji:"ğŸ”§",title:"DonanÄ±m & Runtime DoÄŸrulama",color:"#00d4ff",
 obj:"Her iki DGX Spark'Ä± baÄŸÄ±msÄ±z doÄŸrula. CUDA, driver, Docker ve vLLM tek-dÃ¼ÄŸÃ¼m inference testi. DaÄŸÄ±tÄ±k mod yok.",
 s1:["Driver & CUDA doÄŸrulama","Docker GPU passthrough","vLLM NGC smoke test"],
 s2:["AynÄ± doÄŸrulama baÄŸÄ±msÄ±z tekrar","Spark #1 ile birebir kurulum"],
 tracks:[
  {name:"ğŸ” Driver & CUDA DoÄŸrulama",tag:"ALTYAPI",tc:"#00d4ff",tasks:[
    {t:"DGX OS versiyonunu kontrol et",c:"cat /etc/os-release â†’ Ubuntu 24.04"},
    {t:"CUDA toolkit doÄŸrula",c:"nvcc --version â†’ CUDA 13.0+ gerekli"},
    {t:"GPU gÃ¶rÃ¼nÃ¼rlÃ¼ÄŸÃ¼nÃ¼ kontrol et",c:"nvidia-smi â†’ GB10 Blackwell, sm_121"},
    {t:"UMA bellek notu: nvidia-smi Memory: N/A gÃ¶sterir â€” bu normal",c:"free -h â†’ ~119 GB kullanÄ±labilir"},
    {t:"ARM64 mimarisini doÄŸrula",c:"uname -m â†’ aarch64"},
  ]},
  {name:"ğŸ³ Docker & NVIDIA Container Toolkit",tag:"ALTYAPI",tc:"#00d4ff",tasks:[
    {t:"Docker versiyonunu doÄŸrula",c:"docker --version â†’ Docker 24+ gerekli"},
    {t:"NVIDIA container toolkit kontrolÃ¼",c:"nvidia-ctk --version"},
    {t:"GPU passthrough testi",c:"docker run --rm --gpus all nvcr.io/nvidia/cuda:13.1.0-base-ubuntu24.04 nvidia-smi"},
    {t:"NGC vLLM container'Ä±nÄ± Ã§ek",c:"docker pull nvcr.io/nvidia/vllm:26.01-py3"},
    {t:"NGC auth gerekiyorsa kayÄ±t ol ve giriÅŸ yap",c:"docker login nvcr.io â†’ NGC API key"},
  ]},
  {name:"ğŸ§ª vLLM Smoke Test (Tek DÃ¼ÄŸÃ¼m)",tag:"DOÄRULAMA",tc:"#00e68a",tasks:[
    {t:"Minimal model ile vLLM container'Ä± baÅŸlat",c:"docker run --rm -it --gpus all --shm-size=16g -v ~/.cache/huggingface:/root/.cache/huggingface -p 8000:8000 nvcr.io/nvidia/vllm:26.01-py3 vllm serve facebook/opt-125m --enforce-eager --host 0.0.0.0"},
    {t:"BaÅŸka terminal'den inference testi yap",c:'curl http://localhost:8000/v1/completions -H "Content-Type: application/json" -d \'{"model":"facebook/opt-125m","prompt":"Merhaba","max_tokens":16}\''},
    {t:"YanÄ±tÄ±n geÃ§erli JSON ile token dÃ¶ndÃ¼ÄŸÃ¼nÃ¼ doÄŸrula",c:"response.choices[0].text dolu olmalÄ±"},
    {t:"NOT: --enforce-eager DGX Spark'ta zorunlu (Triton sm_121 desteÄŸi henÃ¼z olgun deÄŸil)",c:"enforce-eager olmadan CUDA graph hatalarÄ± alÄ±rsÄ±n"},
    {t:"AynÄ± smoke test'i Spark #2'de baÄŸÄ±msÄ±z olarak tekrarla",c:"Spark #2'ye SSH â†’ aynÄ± komutlarÄ± Ã§alÄ±ÅŸtÄ±r"},
  ]},
  {name:"ğŸ”— AÄŸ BaÄŸlantÄ±sÄ± Testi (Spark'lar ArasÄ±)",tag:"AÄ",tc:"#4d94ff",tasks:[
    {t:"QSFP56 200GbE DAC kablo ile iki Spark'Ä± fiziksel baÄŸla",c:"0.5m QSFP56 DAC kablo (~$30)"},
    {t:"InfiniBand / Ethernet arayÃ¼zÃ¼nÃ¼ bul",c:"ibdev2netdev veya ip link show"},
    {t:"DoÄŸrudan baÄŸlantÄ± arayÃ¼zÃ¼ne statik IP ata",c:"ip addr add 192.168.100.10/24 dev <iface>"},
    {t:"Spark'lar arasÄ± ping testi",c:"ping -c 5 192.168.100.11"},
    {t:"Bant geniÅŸliÄŸi testi â€” >25 GB/s beklenir",c:"iperf3 -s (bir taraf) / iperf3 -c 192.168.100.11 (diÄŸer taraf)"},
    {t:"Tailscale kur (uzaktan eriÅŸim iÃ§in)",c:"curl -fsSL https://tailscale.com/install.sh | sh && tailscale up"},
  ]},
  {name:"ğŸ“‹ SaÄŸlÄ±k Raporu Kontrol Listesi",tag:"KONTROL",tc:"#ffb84d",tasks:[
    {t:"â˜ Spark #1: nvidia-smi GB10 gÃ¶steriyor",c:"nvidia-smi | grep GB10"},
    {t:"â˜ Spark #1: CUDA 13.x doÄŸrulandÄ±",c:"nvcc --version"},
    {t:"â˜ Spark #1: Docker GPU passthrough Ã§alÄ±ÅŸÄ±yor",c:"docker run --rm --gpus all ... nvidia-smi"},
    {t:"â˜ Spark #1: vLLM opt-125m sunuyor ve token dÃ¶nÃ¼yor",c:"curl localhost:8000/v1/completions"},
    {t:"â˜ Spark #2: YukarÄ±dakilerin hepsi tekrarlandÄ±",c:"SSH spark2 â†’ aynÄ± komutlar"},
    {t:"â˜ AÄŸ: iperf3 >20 GB/s gÃ¶steriyor",c:"iperf3 sonucu kontrol"},
    {t:"â˜ Her iki Spark SSH ile eriÅŸilebilir",c:"ssh spark1 / ssh spark2 veya Tailscale"},
  ]},
 ],
 gov:{"EÅŸzamanlÄ± Ä°stek":"Yok (smoke test)","Batch":"Yok","Token Limiti":"Yok","Retry":"Yok","Kill Switch":"docker stop / Ctrl+C","GPU SÃ¼re":"Yok","PII":"Yok"},
 success:["Her iki Spark baÄŸÄ±msÄ±z vLLM inference sunuyor","AÄŸ >20 GB/s doÄŸrulandÄ±","SaÄŸlÄ±k raporu tÃ¼m maddeler âœ“","DaÄŸÄ±tÄ±k mod denenmedi"]
},
// â•â•â• FAZ 1 â•â•â•
{id:1,emoji:"ğŸ¤–",title:"Tek DÃ¼ÄŸÃ¼m Coding Agent",color:"#00e68a",
 obj:"Spark #1'de stabil coding agent. ÃœÃ§ model vLLM ile, OpenClaw orkestrasyon. Agent kod Ã¼retir, lint yapar, dÃ¼zeltir, derlenen kod dÃ¶ndÃ¼rÃ¼r.",
 s1:["vLLM inference (3 model)","OpenClaw runtime","Coding agent dÃ¶ngÃ¼sÃ¼","Sandbox ortamÄ±"],
 s2:["BoÅŸta veya geliÅŸtirme testi"],
 tracks:[
  {name:"ğŸ§  vLLM Model Deployment â€” Router",tag:"MODEL",tc:"#00d4ff",tasks:[
    {t:"HuggingFace model'i Ã¶nceden indir (opsiyonel, hÄ±zlandÄ±rÄ±r)",c:"huggingface-cli download meta-llama/Llama-3.1-8B-Instruct"},
    {t:"Router container'Ä± baÅŸlat â€” port 8001",c:"docker run -d --gpus all --shm-size=8g --name vllm-router -v ~/.cache/huggingface:/root/.cache/huggingface -p 8001:8000 nvcr.io/nvidia/vllm:26.01-py3 vllm serve meta-llama/Llama-3.1-8B-Instruct --enforce-eager --max-model-len 8192 --gpu-memory-utilization 0.08 --max-num-seqs 16"},
    {t:"Router saÄŸlÄ±k kontrolÃ¼",c:'curl http://localhost:8001/v1/models'},
    {t:"Router inference testi",c:'curl localhost:8001/v1/completions -H "Content-Type: application/json" -d \'{"model":"meta-llama/Llama-3.1-8B-Instruct","prompt":"classify: generate code","max_tokens":8}\''},
  ]},
  {name:"ğŸ§  vLLM Model Deployment â€” Reasoning",tag:"MODEL",tc:"#00e68a",tasks:[
    {t:"Qwen3-32B model'i indir",c:"huggingface-cli download Qwen/Qwen3-32B"},
    {t:"Reasoning container'Ä± baÅŸlat â€” port 8002",c:"docker run -d --gpus all --shm-size=16g --name vllm-reasoning -v ~/.cache/huggingface:/root/.cache/huggingface -p 8002:8000 nvcr.io/nvidia/vllm:26.01-py3 vllm serve Qwen/Qwen3-32B --enforce-eager --max-model-len 32768 --gpu-memory-utilization 0.35 --max-num-seqs 4"},
    {t:"Reasoning saÄŸlÄ±k kontrolÃ¼",c:'curl http://localhost:8002/v1/models'},
    {t:"Bellek durumunu kontrol et",c:"free -h â†’ kullanÄ±labilir RAM kontrol"},
  ]},
  {name:"ğŸ’» vLLM Model Deployment â€” Coder",tag:"MODEL",tc:"#4d94ff",tasks:[
    {t:"Qwen3-Coder-30B model'i indir",c:"huggingface-cli download Qwen/Qwen3-Coder-30B-Instruct"},
    {t:"Coder container'Ä± baÅŸlat â€” port 8003",c:"docker run -d --gpus all --shm-size=16g --name vllm-coder -v ~/.cache/huggingface:/root/.cache/huggingface -p 8003:8000 nvcr.io/nvidia/vllm:26.01-py3 vllm serve Qwen/Qwen3-Coder-30B-Instruct --enforce-eager --max-model-len 32768 --gpu-memory-utilization 0.35 --max-num-seqs 4"},
    {t:"Coder saÄŸlÄ±k kontrolÃ¼",c:'curl http://localhost:8003/v1/models'},
    {t:"ÃœÃ§ model birlikte bellek kontrolÃ¼ (toplam <0.80)",c:"free -h â†’ â‰¥20 GB boÅŸ olmalÄ±"},
    {t:"OOM durumunda buffer cache temizle",c:"sync && echo 3 | sudo tee /proc/sys/vm/drop_caches"},
  ]},
  {name:"ğŸ”Œ OpenClaw Kurulumu",tag:"ORKESTRASYON",tc:"#b08cff",tasks:[
    {t:"Node.js 22+ kur (ARM64)",c:"curl -fsSL https://deb.nodesource.com/setup_22.x | sudo -E bash - && sudo apt install -y nodejs"},
    {t:"OpenClaw global kur",c:"npm install -g openclaw"},
    {t:"OpenClaw baÅŸlangÄ±Ã§ sihirbazÄ±nÄ± Ã§alÄ±ÅŸtÄ±r",c:"openclaw onboard"},
    {t:"config.json'da vLLM provider'larÄ± ekle (router/reasoning/coder)",c:"nano ~/.openclaw/config.json â†’ baseUrl: localhost:8001/8002/8003"},
    {t:"Claude API fallback ekle (Anthropic provider)",c:"anthropic bÃ¶lÃ¼mÃ¼ne API key ekle"},
    {t:"OpenClaw'u daemon olarak Ã§alÄ±ÅŸtÄ±r (7/24)",c:"openclaw onboard --install-daemon"},
    {t:"Telegram bot baÄŸlantÄ±sÄ± (opsiyonel)",c:"@BotFather â†’ token al â†’ openclaw'a ekle"},
  ]},
  {name:"ğŸ”€ Model YÃ¶nlendirme YapÄ±landÄ±rmasÄ±",tag:"ORKESTRASYON",tc:"#b08cff",tasks:[
    {t:"Router skill yaz: prompt â†’ sÄ±nÄ±fla â†’ ilgili modele ilet",c:"SKILL.md: classify task type â†’ route to port"},
    {t:"YÃ¶nlendirme kurallarÄ±: intent â†’ 8001, reasoning â†’ 8002, code â†’ 8003",c:"JSON routing table oluÅŸtur"},
    {t:"Fallback zinciri: model hata â†’ 1 retry â†’ Claude API",c:"OpenClaw fallback config"},
    {t:"YÃ¶nlendirme testleri: farklÄ± gÃ¶rev tÃ¼rleri ile doÄŸrula",c:"generate / refactor / debug / explain test et"},
  ]},
  {name:"ğŸ”„ Coding Agent DÃ¶ngÃ¼sÃ¼ Kurulumu",tag:"AGENT",tc:"#4d94ff",tasks:[
    {t:"Agent skill yaz: gÃ¶rev al â†’ kod Ã¼ret â†’ lint â†’ dÃ¶ndÃ¼r",c:"SKILL.md: coding-agent skill tanÄ±mla"},
    {t:"Sandbox Docker image oluÅŸtur (aÄŸ eriÅŸimsiz)",c:"docker build -t sandbox:latest . (--network=none ile Ã§alÄ±ÅŸacak)"},
    {t:"Linter kur: Python â†’ ruff, JS/TS â†’ eslint",c:"pip install ruff && npm install -g eslint"},
    {t:"Lint pipeline'Ä± test et: Ã¼retilen kodu otomatik tara",c:"ruff check /tmp/workspace/output.py"},
    {t:"Derleme kontrolÃ¼: syntax check pipeline'Ä±",c:"python -c \"compile(open('output.py').read(),'output.py','exec')\""},
    {t:"Hata â†’ dÃ¼zelt dÃ¶ngÃ¼sÃ¼: lint hatasÄ± â†’ kodu + hatayÄ± Coder'a gÃ¶nder â†’ max 2 retry",c:"retry_count â‰¤ 2 â†’ re-generate, else â†’ return partial"},
    {t:"End-to-end test: 'Python fibonacci fonksiyonu yaz' â†’ lint geÃ§en kod dÃ¶nsÃ¼n",c:"Telegram/API'den test gÃ¶nder â†’ sonucu doÄŸrula"},
  ]},
  {name:"ğŸ”’ Sandbox & PII GÃ¼venliÄŸi",tag:"GÃœVENLÄ°K",tc:"#ff5c6e",tasks:[
    {t:"Sandbox container'Ä±: aÄŸ yok, salt-okunur FS, sadece /tmp/workspace yazÄ±labilir",c:"docker run --rm --network=none --read-only --tmpfs /tmp/workspace sandbox:latest"},
    {t:"Ã‡alÄ±ÅŸtÄ±rma timeout: 30 saniye",c:"timeout 30 python /tmp/workspace/output.py"},
    {t:"PII maskeleme regex'leri hazÄ±rla",c:"email, API key (sk-...), token ([A-Za-z0-9+/=]{32,}) pattern'leri"},
    {t:"TÃ¼m gelen prompt'larda PII taramasÄ±nÄ± aktifleÅŸtir",c:"preprocess_hook: scan â†’ mask â†’ forward"},
    {t:"Host env deÄŸiÅŸkenleri sandbox'a iletilMEMELÄ°",c:"docker run'da --env ile sadece izin verilenler"},
  ]},
  {name:"ğŸ›‘ Kill Switch & Watchdog",tag:"GÃœVENLÄ°K",tc:"#ff5c6e",tasks:[
    {t:"Kill switch scripti yaz: tÃ¼m vLLM container'larÄ±nÄ± durdur",c:"docker stop vllm-router vllm-reasoning vllm-coder â†’ kill-all.sh"},
    {t:"Telegram /kill komutu â†’ kill-all.sh tetikle",c:"OpenClaw skill: /kill â†’ exec kill-all.sh"},
    {t:"Cron watchdog: 1 dk'da bir bellek kontrol",c:"crontab: * * * * * /opt/watchdog.sh"},
    {t:"Watchdog kuralÄ±: free memory <5 GB â†’ otomatik vLLM restart",c:"if [[ $(free -g | awk '/Mem/{print $7}') -lt 5 ]]; then docker restart ..."},
    {t:"Watchdog loglarÄ±",c:"/var/log/watchdog.log â†’ tarih, bellek, aksiyon"},
  ]},
  {name:"ğŸ“ Temel Loglama",tag:"GÃ–ZLEM",tc:"#ffb84d",tasks:[
    {t:"SQLite log veritabanÄ± oluÅŸtur",c:"sqlite3 /var/log/coding-agent/requests.db 'CREATE TABLE logs(...)'"},
    {t:"Her istek: timestamp, model, tokens_in, tokens_out, latency_ms, status",c:"INSERT INTO logs VALUES(...)"},
    {t:"GÃ¼nlÃ¼k log rotasyonu ayarla",c:"logrotate /etc/logrotate.d/coding-agent"},
    {t:"Basit log sorgusu test et",c:"sqlite3 requests.db 'SELECT model, avg(latency_ms) FROM logs GROUP BY model'"},
  ]},
 ],
 gov:{"EÅŸzamanlÄ±":"Model baÅŸÄ±na 4","Batch":"Router:16 / Reason:4 / Coder:4","Token":"Router:8K / Reason:32K / Coder:32K","Retry":"Ä°stek baÅŸÄ±na 1 â†’ Claude fallback","Kill Switch":"Telegram /kill â†’ docker stop","GPU SÃ¼re":"HenÃ¼z yok (Faz 3)","PII":"Regex tarama aktif"},
 success:["Agent kodlama gÃ¶revi alÄ±p sÃ¶zdizimsel geÃ§erli kod Ã¼retiyor","Linter Ã§Ä±ktÄ±da geÃ§iyor","Derleme kontrolÃ¼ geÃ§iyor","Hata durumunda 1 retry ile dÃ¼zeltme","ÃœÃ§ model eÅŸzamanlÄ± OOM'suz Ã§alÄ±ÅŸÄ±yor","Kill switch 5 sn'de durduruyor","TÃ¼m istekler SQLite'a loglanÄ±yor"]
},
// â•â•â• FAZ 2 â•â•â•
{id:2,emoji:"ğŸ”„",title:"Oto-DÃ¼zeltme & Kalite KatmanÄ±",color:"#4d94ff",
 obj:"Oto-dÃ¼zeltme dÃ¶ngÃ¼sÃ¼, semantik Ã¶nbellek, prompt versiyonlama, yapÄ±landÄ±rÄ±lmÄ±ÅŸ izleme. HÃ¢lÃ¢ tek dÃ¼ÄŸÃ¼m.",
 s1:["vLLM inference (deÄŸiÅŸmez)","GeliÅŸmiÅŸ agent mantÄ±ÄŸÄ±","Semantik cache","Trace sistemi"],
 s2:["HÃ¢lÃ¢ boÅŸta veya dev test"],
 tracks:[
  {name:"ğŸ”§ Oto-DÃ¼zeltme Pipeline",tag:"AGENT",tc:"#4d94ff",tasks:[
    {t:"Correction loop'u yapÄ±landÄ±r: Ã¼ret â†’ lint â†’ hata varsa â†’ dÃ¼zelt â†’ yeniden lint",c:"correction_pipeline.py â†’ max_retries=2"},
    {t:"Hata baÄŸlamÄ± ÅŸablonu: orijinal prompt + kod + error output â†’ fix prompt",c:"fix_template.txt: 'Bu hatalarÄ± dÃ¼zelt. Sadece kodu dÃ¶ndÃ¼r.'"},
    {t:"mypy entegrasyonu ekle (tip kontrolÃ¼)",c:"pip install mypy && mypy --ignore-missing-imports output.py"},
    {t:"DÃ¼zeltme metriÄŸini logla: corrections_attempted vs corrections_resolved",c:"SQLite'a correction_success_rate sÃ¼tunu ekle"},
    {t:"2 baÅŸarÄ±sÄ±z deneme sonrasÄ±: kÄ±smi sonuÃ§ + hata raporu dÃ¶ndÃ¼r",c:"status: 'partial' + error_details JSON"},
    {t:"End-to-end test: kasÄ±tlÄ± hatalÄ± prompt â†’ dÃ¼zeltme â†’ geÃ§en kod",c:"'write fibonacci with off-by-one error' â†’ auto-fix test"},
  ]},
  {name:"ğŸ“Š Ä°stek SÄ±nÄ±flandÄ±rmasÄ±",tag:"YÃ–NLENDÄ°RME",tc:"#b08cff",tasks:[
    {t:"Ä°ki mod tanÄ±mla: interactive (kullanÄ±cÄ± bekliyor) vs batch (arka plan)",c:"request_type: 'interactive' | 'batch'"},
    {t:"Interactive: max 30sn timeout, kÃ¼Ã§Ã¼k context, Ã¶ncelikli kuyruk",c:"asyncio.wait_for(generate(), timeout=30)"},
    {t:"Batch: timeout yok, tam context, GPU boÅŸken Ã§alÄ±ÅŸÄ±r",c:"background_queue.put(task)"},
    {t:"Redis Ã¶ncelik kuyruÄŸu kur",c:"pip install redis && redis-server â†’ LPUSH/BRPOP"},
    {t:"SÄ±nÄ±flandÄ±rma Router tarafÄ±ndan otomatik yapÄ±lÄ±r (kaynak + metadata)",c:"source='telegram' â†’ interactive, source='cron' â†’ batch"},
  ]},
  {name:"ğŸ’¾ Semantik Ã–nbellek",tag:"PERFORMANS",tc:"#00d4ff",tasks:[
    {t:"Cache DB oluÅŸtur (SQLite + FTS5 veya Redis)",c:"sqlite3 cache.db 'CREATE VIRTUAL TABLE cache USING fts5(...)'"},
    {t:"Prompt hash fonksiyonu: normalize â†’ SHA256",c:"hashlib.sha256(normalize(prompt).encode()).hexdigest()"},
    {t:"Cache hit kriteri: kosinÃ¼s benzerliÄŸi >0.95",c:"sklearn.metrics.pairwise.cosine_similarity"},
    {t:"TTL ayarla: interactive=24h, batch=7d",c:"INSERT INTO cache(prompt_hash, result, ttl, created_at)"},
    {t:"Telegram /cache-clear komutu ekle",c:"OpenClaw skill: DELETE FROM cache"},
    {t:"Cache hit rate logla",c:"cache_hit / total_requests â†’ saatlik metrik"},
  ]},
  {name:"ğŸ“š Prompt Versiyonlama",tag:"KALÄ°TE",tc:"#00e68a",tasks:[
    {t:"Prompt dizin yapÄ±sÄ± oluÅŸtur",c:"mkdir -p /etc/coding-agent/prompts/v1/"},
    {t:"Her rol iÃ§in prompt dosyasÄ±: router.txt, coder-generate.txt, coder-fix.txt, reasoning.txt",c:"nano /etc/coding-agent/prompts/v1/coder-generate.txt"},
    {t:"Prompt version'Ä± request log'a ekle",c:"ALTER TABLE logs ADD COLUMN prompt_version TEXT"},
    {t:"Versiyon artÄ±ÅŸÄ± prosedÃ¼rÃ¼: v1/ â†’ v2/ kopyala, deÄŸiÅŸtir, test et",c:"cp -r v1/ v2/ â†’ edit â†’ PROMPT_VERSION=2"},
    {t:"Geri alma mekanizmasÄ±: PROMPT_VERSION env ile Ã¶nceki versiyona dÃ¶n",c:"export PROMPT_VERSION=1 â†’ restart agent"},
    {t:"A/B test altyapÄ±sÄ±: %50/%50 trafik bÃ¶lme (opsiyonel)",c:"random.random() < 0.5 â†’ v1 else v2"},
  ]},
  {name:"ğŸ“¡ YapÄ±landÄ±rÄ±lmÄ±ÅŸ Ä°zleme (Tracing)",tag:"GÃ–ZLEM",tc:"#ffb84d",tasks:[
    {t:"trace_id Ã¼reteci: her istekte UUID v4",c:"import uuid; trace_id = str(uuid.uuid4())"},
    {t:"TÃ¼m adÄ±mlara trace_id yay: generate â†’ lint â†’ fix â†’ re-lint",c:"trace_id parametresini her fonksiyona ilet"},
    {t:"Log ÅŸemasÄ± gÃ¼ncelle: trace_id | step | model | tokens | latency | status | prompt_ver",c:"ALTER TABLE logs ADD COLUMN trace_id TEXT, step TEXT"},
    {t:"Saatlik metrik hesaplama cron'u kur",c:"crontab: 0 * * * * python /opt/compute_metrics.py"},
    {t:"Metrikler: p50/p95/p99 latency, tok/s, correction rate, cache hit, error rate",c:"SELECT percentile(latency_ms, 0.95) FROM logs WHERE ..."},
    {t:"Statik HTML dashboard oluÅŸtur (port 9090)",c:"python -m http.server 9090 -d /var/www/dashboard/"},
    {t:"Dashboard'u cron ile saatlik gÃ¼ncelle",c:"0 * * * * python /opt/generate_dashboard.py"},
  ]},
 ],
 gov:{"EÅŸzamanlÄ±":"Interactive:2 + Batch:2 = 4","Batch":"DeÄŸiÅŸmez","Token":"Ä°stek:32K / Dakika:200K toplam","Retry":"GÃ¶rev:2 dÃ¼zeltme + Model:1 retry","Kill Switch":"/kill + /pause + /resume","GPU SÃ¼re":"HenÃ¼z yok","PII":"Regex + keyword blocklist"},
 success:["Oto-dÃ¼zeltme hatalarÄ±n >%60'Ä±nÄ± 2 denemede Ã§Ã¶zÃ¼yor","Cache >%20 hit rate","Prompt versiyonlama + geri alma Ã§alÄ±ÅŸÄ±yor","trace_id ile uÃ§tan uca izleme","Dashboard saatlik metrik gÃ¶steriyor","Interactive <30sn tamamlanÄ±yor"]
},
// â•â•â• FAZ 3 â•â•â•
{id:3,emoji:"âš¡",title:"Dual Spark KullanÄ±mÄ±",color:"#b08cff",
 obj:"Spark #2: policy engine, audit, aÄŸÄ±r model. HÄ±z sÄ±nÄ±rlama, GPU sÃ¼re muhasebesi. Tensor parallel opsiyonel doÄŸrulama.",
 s1:["Ãœretim coding agent (deÄŸiÅŸmez)","vLLM router + reasoning + coder"],
 s2:["Policy engine (FastAPI)","Audit DB (PostgreSQL + Grafana)","Batch dev model"],
 tracks:[
  {name:"ğŸ—ï¸ Spark #2 Temel Kurulum",tag:"ALTYAPI",tc:"#b08cff",tasks:[
    {t:"Spark #2'de Python 3.12+ ortam hazÄ±rla",c:"sudo apt install python3.12 python3.12-venv"},
    {t:"PostgreSQL kur (audit veritabanÄ±)",c:"sudo apt install postgresql && sudo systemctl start postgresql"},
    {t:"Redis kur (rate limiting + kuyruk)",c:"sudo apt install redis-server && sudo systemctl start redis"},
    {t:"Grafana kur (dashboard)",c:"sudo apt install grafana && sudo systemctl start grafana-server"},
    {t:"FastAPI + uvicorn kur",c:"pip install fastapi uvicorn[standard]"},
    {t:"Spark #1 â†’ Spark #2 HTTP baÄŸlantÄ±sÄ±nÄ± test et",c:"curl http://192.168.100.11:8100/health"},
  ]},
  {name:"ğŸ›¡ï¸ Policy Engine (Spark #2 â€” Port 8100)",tag:"GOVERNANCE",tc:"#ff5c6e",tasks:[
    {t:"FastAPI policy engine projesi oluÅŸtur",c:"mkdir /opt/policy-engine && cd /opt/policy-engine"},
    {t:"policies.json kural dosyasÄ± yaz",c:'{"tier1":["generate","lint","search"],"tier2":["email","deploy"],"tier3":["delete","production"]}'},
    {t:"Tier deÄŸerlendirme endpoint'i: POST /evaluate â†’ allow/deny/escalate",c:"@app.post('/evaluate') â†’ check tier â†’ return decision"},
    {t:"Spark #1 agent'Ä±nÄ± policy engine'e baÄŸla: her aksiyon Ã¶ncesi /evaluate Ã§aÄŸÄ±r",c:"pre_action_hook: requests.post('http://spark2:8100/evaluate', json=action)"},
    {t:"Tier 2 aksiyonlar iÃ§in Telegram onay mekanizmasÄ±",c:"Telegram'a onay butonu gÃ¶nder â†’ /approve veya /deny"},
    {t:"Policy engine'i systemd servisi olarak Ã§alÄ±ÅŸtÄ±r",c:"systemctl enable policy-engine â†’ 7/24 Ã§alÄ±ÅŸÄ±r"},
  ]},
  {name:"â±ï¸ GPU SÃ¼re Muhasebesi",tag:"GOVERNANCE",tc:"#ff5c6e",tasks:[
    {t:"gpu_time tablosu oluÅŸtur (PostgreSQL)",c:"CREATE TABLE gpu_time(agent TEXT, model TEXT, start_ts TIMESTAMP, end_ts TIMESTAMP, tokens INT)"},
    {t:"Her inference isteÄŸinde baÅŸlangÄ±Ã§/bitiÅŸ zamanÄ±nÄ± kaydet",c:"before_request: record start â†’ after_request: record end"},
    {t:"GÃ¼nlÃ¼k bÃ¼tÃ§e: agent baÅŸÄ±na max 4 GPU-saat",c:"SELECT SUM(end_ts - start_ts) FROM gpu_time WHERE agent=? AND date=today"},
    {t:"%80 uyarÄ± â†’ Telegram bildirimi",c:"if daily_usage > 0.8 * budget: send_telegram_alert()"},
    {t:"%100 aÅŸÄ±m â†’ istekleri kuyruÄŸa al (ertesi gÃ¼ne)",c:"if daily_usage >= budget: return 429"},
    {t:"HaftalÄ±k rapor cron'u: agent Ã— model Ã— toplam saat",c:"crontab: 0 9 * * 1 python /opt/weekly_gpu_report.py"},
  ]},
  {name:"ğŸš¦ HÄ±z SÄ±nÄ±rlama (Rate Limiting)",tag:"GOVERNANCE",tc:"#ff5c6e",tasks:[
    {t:"Redis sliding window rate limiter implement et",c:"pip install redis â†’ sliding_window_counter.py"},
    {t:"Router (Llama 8B): 60 RPM",c:"RATE_LIMIT_ROUTER=60"},
    {t:"Reasoning (Qwen 32B): 10 RPM",c:"RATE_LIMIT_REASONING=10"},
    {t:"Coder (Qwen Coder 30B): 10 RPM",c:"RATE_LIMIT_CODER=10"},
    {t:"Claude API fallback: 5 RPM + aylÄ±k $150 hard cap",c:"RATE_LIMIT_CLAUDE=5, MONTHLY_CAP=150"},
    {t:"AÅŸÄ±lÄ±nca HTTP 429 dÃ¶ndÃ¼r â†’ agent bekleme + retry",c:"return JSONResponse(status_code=429, content={'retry_after': window_remaining})"},
  ]},
  {name:"ğŸ§ª Tensor Parallel AÄŸ Testi (Opsiyonel)",tag:"DENEYSEL",tc:"#ffb84d",tasks:[
    {t:"Ray kur (her iki Spark'a)",c:"pip install ray[default]"},
    {t:"Spark #1'de Ray head baÅŸlat",c:"ray start --head --port=6379"},
    {t:"Spark #2'de Ray worker baÅŸlat",c:"ray start --address=192.168.100.10:6379"},
    {t:"Ray cluster durumunu doÄŸrula",c:"ray status â†’ 2 node, 2 GPU beklenir"},
    {t:"KÃ¼Ã§Ã¼k model ile TP=2 test: Llama 8B",c:"vllm serve meta-llama/Llama-3.1-8B-Instruct --tensor-parallel-size 2 --distributed-executor-backend ray"},
    {t:"Tek dÃ¼ÄŸÃ¼m vs Ã§ift dÃ¼ÄŸÃ¼m gecikme karÅŸÄ±laÅŸtÄ±r",c:"benchmark her ikisinde â†’ fark >%50 ise ertelĞµ"},
    {t:"NOT: Bu fazda 235B model Ã‡ALIÅTIRMA",c:"Yetersiz doÄŸrulama â€” Faz 4+ iÃ§in"},
  ]},
 ],
 gov:{"EÅŸzamanlÄ±":"S1:4 Ã¼retim / S2:2 batch","Batch":"DeÄŸiÅŸmez","Token":"Saat:500K / GÃ¼n:5M","Retry":"2 dÃ¼zeltme + 1 model + Claude:1","Kill Switch":"/kill (her iki Spark) + /kill-spark1/2","GPU SÃ¼re":"Agent baÅŸÄ±na gÃ¼nlÃ¼k 4 saat","PII":"Regex + keyword + policy engine"},
 success:["Spark #2 policy + audit + batch model sunuyor","TÃ¼m aksiyonlar policy engine'den geÃ§iyor","Rate limiting uygulanÄ±yor (429)","GPU sÃ¼re gÃ¼nlÃ¼k rapor Ã¼retiyor","AÄŸ >20 GB/s doÄŸrulandÄ±","TP test edildiyse gecikme belgelendi"]
},
// â•â•â• FAZ 4 â•â•â•
{id:4,emoji:"ğŸš€",title:"Performans Optimizasyonu",color:"#ffb84d",
 obj:"Opsiyonel ileri faz. SpekÃ¼latif Ã§Ã¶zÃ¼mleme, batch zamanlama, bellek eÅŸik kontrolÃ¼, geliÅŸmiÅŸ gÃ¶zlemlenebilirlik.",
 s1:["Optimize Ã¼retim inference","Speculative decoding","Batch scheduling"],
 s2:["Grafana + Prometheus","Benchmark suite","Kapasite planlama"],
 tracks:[
  {name:"âš¡ SpekÃ¼latif Ã‡Ã¶zÃ¼mleme (Speculative Decoding)",tag:"PERFORMANS",tc:"#ffb84d",tasks:[
    {t:"vLLM speculative decoding flag'Ä±nÄ± test et",c:"--speculative-model meta-llama/Llama-3.1-8B-Instruct --num-speculative-tokens 5"},
    {t:"Qwen 32B reasoning'de speculative decode aktifleÅŸtir",c:"docker run ... vllm serve Qwen/Qwen3-32B --speculative-model ..."},
    {t:"enforce-eager ile uyumluluÄŸu kontrol et",c:"Ã‡alÄ±ÅŸmÄ±yorsa â†’ bu optimizasyonu ertele"},
    {t:"Benchmark: speculative vs normal â†’ 1.3x+ hÄ±zlanma hedefi",c:"llama-benchy ile karÅŸÄ±laÅŸtÄ±r"},
  ]},
  {name:"ğŸ“… Batch Zamanlama & Gece Modu",tag:"PERFORMANS",tc:"#ffb84d",tasks:[
    {t:"Gece modu cron tanÄ±mla: 00:00-06:00 arasÄ± batch-only",c:"crontab: 0 0 * * * /opt/enter_night_mode.sh"},
    {t:"Gece modunda interactive slotlarÄ± batch'e aÃ§",c:"max_concurrent_batch = 4 (gece) vs 2 (gÃ¼ndÃ¼z)"},
    {t:"Otomatik model swap: gece daha bÃ¼yÃ¼k context yÃ¼kle (opsiyonel)",c:"--max-model-len 65536 (gece) vs 32768 (gÃ¼ndÃ¼z)"},
    {t:"Sabah 06:00'da normal moda dÃ¶n",c:"crontab: 0 6 * * * /opt/enter_day_mode.sh"},
  ]},
  {name:"ğŸ’¾ Bellek EÅŸik KontrolÃ¼ (Memory Watermark)",tag:"KARARLLIK",tc:"#ff5c6e",tasks:[
    {t:"Watchdog'u eÅŸik bazlÄ± yÃ¼kselt",c:"watermark.sh â†’ green/yellow/red/critical seviyeler"},
    {t:"ğŸŸ¢ YeÅŸil (<70%): normal Ã§alÄ±ÅŸma",c:"no action"},
    {t:"ğŸŸ¡ SarÄ± (70-85%): max_num_seqs %50 azalt + Telegram uyarÄ±",c:"docker update --cpus... + send alert"},
    {t:"ğŸ”´ KÄ±rmÄ±zÄ± (>85%): yeni istek kabul etme + boÅŸalt + uyar",c:"set accepting=false, drain queue"},
    {t:"ğŸ’€ Kritik (>95%): buffer cache temizle + vLLM restart",c:"sync && echo 3 > /proc/sys/vm/drop_caches && docker restart ..."},
    {t:"Spark'lar arasÄ± zombie koruma: S2 S1'i izler, 5dk yanÄ±tsÄ±zsa restart",c:"ssh spark1 'uptime' timeout 10 || ssh spark1 'sudo reboot'"},
  ]},
  {name:"ğŸ“¡ GeliÅŸmiÅŸ GÃ¶zlemlenebilirlik",tag:"GÃ–ZLEM",tc:"#00d4ff",tasks:[
    {t:"Prometheus kur (Spark #2)",c:"sudo apt install prometheus"},
    {t:"vLLM /metrics endpoint'ini Prometheus'a baÄŸla",c:"prometheus.yml â†’ scrape_configs: targets: ['spark1:8001','spark1:8002','spark1:8003']"},
    {t:"Grafana dashboard'larÄ± oluÅŸtur: GPU, kuyruk, token verimi",c:"Grafana â†’ Import dashboard â†’ vLLM metrics"},
    {t:"Alert kurallarÄ±: p99 >60s, hata >%5, bellek >%85",c:"alertmanager â†’ telegram webhook"},
    {t:"Maliyet muhasebesi: istek baÅŸÄ±na tahmini $ (token Ã— cloud fiyat)",c:"cost_per_request = tokens * $0.003/1000"},
    {t:"llama-benchy ile kapsamlÄ± benchmark suite Ã§alÄ±ÅŸtÄ±r",c:"llama-benchy --models all --concurrency 1,2,4,8"},
  ]},
 ],
 gov:{"EÅŸzamanlÄ±":"Dinamik: 4(yeÅŸil) / 2(sarÄ±) / 0(kÄ±rmÄ±zÄ±)","Batch":"Dinamik: bellek durumuna gÃ¶re","Token":"Faz 3 ile aynÄ±","Retry":"Faz 3 ile aynÄ±","Kill Switch":"Watchdog oto-kill + Spark arasÄ± uzaktan kill","GPU SÃ¼re":"Maliyet tahmini ile tam muhasebe","PII":"Faz 3 ile aynÄ±"},
 success:["Speculative decode >1.3x hÄ±zlanma (Ã§alÄ±ÅŸÄ±yorsa)","Bellek eÅŸik 7 gÃ¼n OOM'suz","Grafana gerÃ§ek zamanlÄ± metrik","Benchmark sonuÃ§larÄ± belgelendi","Gece modu batch tamamlÄ±yor"]
}
];

// â•â•â• MODEL DATA â•â•â•
const MT=[
  {tier:"Tier 1",emoji:"âš¡",role:"Router",model:"Llama-3.1-8B-Instruct",q:"FP16/NVFP4",ram:"~8-10 GB",spd:"~50-90 tok/s",ctx:"8K",port:"8001",use:"GÃ¶rev sÄ±nÄ±flandÄ±rma, niyet tespiti, yÃ¶nlendirme. HÄ±zlÄ± yanÄ±t gerekli.",c:"#00d4ff"},
  {tier:"Tier 2",emoji:"ğŸ§ ",role:"Reasoning",model:"Qwen3-32B",q:"FP16/BF16",ram:"~35-40 GB",spd:"~15-25 tok/s",ctx:"32K",port:"8002",use:"Mimari planlama, karmaÅŸÄ±k debug, Ã§ok adÄ±mlÄ± reasoning.",c:"#00e68a"},
  {tier:"Tier 3",emoji:"ğŸ’»",role:"Coding",model:"Qwen3-Coder-30B-Instruct",q:"FP16/BF16",ram:"~35 GB",spd:"~15-25 tok/s",ctx:"32K",port:"8003",use:"Kod Ã¼retimi, refactoring, bug fix, test yazma.",c:"#4d94ff"},
  {tier:"Tier X",emoji:"â˜ï¸",role:"Fallback",model:"Claude Sonnet 4 (API)",q:"Cloud",ram:"N/A",spd:"~80+ tok/s",ctx:"200K",port:"API",use:"Lokal baÅŸarÄ±sÄ±z â†’ fallback. AylÄ±k $150 cap.",c:"#555568"},
];
const RI=[{l:"Llama 3.1 8B",gb:10,c:"#00d4ff"},{l:"Qwen3-32B",gb:38,c:"#00e68a"},{l:"Qwen Coder 30B",gb:35,c:"#4d94ff"},{l:"KV Cache",gb:20,c:"#ffb84d"},{l:"OS+Docker+Agent",gb:8,c:"#555568"},{l:"Headroom",gb:8,c:"#2a2a3a"}];

// â•â•â• Ã–N GEREKSÄ°NÄ°MLER â•â•â•
const PREREQS=[
  {name:"ğŸ§ Sistem GÃ¼ncelleme",tag:"OS",tc:"#00d4ff",tasks:[
    {t:"Paket listesini gÃ¼ncelle",c:"sudo apt update && sudo apt upgrade -y"},
    {t:"Temel build araÃ§larÄ±nÄ± kur",c:"sudo apt install -y build-essential cmake ninja-build git curl wget unzip software-properties-common"},
    {t:"Net-tools & aÄŸ araÃ§larÄ±",c:"sudo apt install -y net-tools iperf3 htop tmux jq"},
    {t:"SSH server'Ä±n Ã§alÄ±ÅŸtÄ±ÄŸÄ±nÄ± doÄŸrula",c:"sudo systemctl status ssh â†’ active (running)"},
  ]},
  {name:"ğŸ Python 3.12+",tag:"RUNTIME",tc:"#ffb84d",tasks:[
    {t:"Python versiyonunu kontrol et",c:"python3 --version â†’ 3.12+ olmalÄ±"},
    {t:"Python yoksa veya eskiyse kur",c:"sudo apt install -y python3.12 python3.12-venv python3.12-dev python3-pip"},
    {t:"pip gÃ¼ncelle",c:"python3 -m pip install --upgrade pip --break-system-packages"},
    {t:"venv desteÄŸini doÄŸrula",c:"python3 -m venv /tmp/test-env && rm -rf /tmp/test-env"},
    {t:"HuggingFace CLI kur (model indirmek iÃ§in)",c:"pip install --break-system-packages huggingface-cli"},
    {t:"HuggingFace'e login ol (gated modeller iÃ§in)",c:"huggingface-cli login â†’ token gir"},
  ]},
  {name:"ğŸŸ¢ Node.js 22+ (OpenClaw iÃ§in)",tag:"RUNTIME",tc:"#00e68a",tasks:[
    {t:"NodeSource repo ekle (ARM64)",c:"curl -fsSL https://deb.nodesource.com/setup_22.x | sudo -E bash -"},
    {t:"Node.js kur",c:"sudo apt install -y nodejs"},
    {t:"Versiyonu doÄŸrula",c:"node --version â†’ v22.x+ && npm --version â†’ 10.x+"},
    {t:"npm global dizinini ayarla (sudo'suz kurulum)",c:"mkdir -p ~/.npm-global && npm config set prefix '~/.npm-global' && echo 'export PATH=~/.npm-global/bin:$PATH' >> ~/.bashrc && source ~/.bashrc"},
  ]},
  {name:"ğŸ³ Docker & NVIDIA Container Toolkit",tag:"CONTAINER",tc:"#4d94ff",tasks:[
    {t:"Docker kurulumunu kontrol et (DGX OS'ta genelde yÃ¼klÃ¼)",c:"docker --version â†’ 24+ olmalÄ±"},
    {t:"Docker yoksa kur",c:"curl -fsSL https://get.docker.com | sh && sudo usermod -aG docker $USER"},
    {t:"Docker daemon'Ä±n Ã§alÄ±ÅŸtÄ±ÄŸÄ±nÄ± doÄŸrula",c:"sudo systemctl status docker â†’ active"},
    {t:"NVIDIA Container Toolkit kontrol",c:"nvidia-ctk --version"},
    {t:"Toolkit yoksa kur",c:"curl -fsSL https://nvidia.github.io/libnvidia-container/gpgkey | sudo gpg --dearmor -o /usr/share/keyrings/nvidia-container-toolkit-keyring.gpg && sudo apt update && sudo apt install -y nvidia-container-toolkit && sudo nvidia-ctk runtime configure --runtime=docker && sudo systemctl restart docker"},
    {t:"GPU passthrough testi",c:"docker run --rm --gpus all nvcr.io/nvidia/cuda:13.1.0-base-ubuntu24.04 nvidia-smi"},
    {t:"NGC registry login (vLLM container iÃ§in)",c:"docker login nvcr.io â†’ Username: $oauthtoken, Password: NGC API key"},
    {t:"NGC vLLM container'Ä±nÄ± Ã¶nceden Ã§ek",c:"docker pull nvcr.io/nvidia/vllm:26.01-py3"},
  ]},
  {name:"ğŸ”§ CUDA Toolkit DoÄŸrulama",tag:"GPU",tc:"#b08cff",tasks:[
    {t:"CUDA versiyonunu kontrol et (DGX OS'ta yÃ¼klÃ¼ gelir)",c:"nvcc --version â†’ CUDA 13.0+ olmalÄ±"},
    {t:"GPU'yu doÄŸrula",c:"nvidia-smi â†’ NVIDIA GB10 Blackwell, sm_121"},
    {t:"UMA bellek notu: nvidia-smi Memory: N/A gÃ¶sterir â€” bu normal",c:"free -h â†’ ~119 GB kullanÄ±labilir (GPU+CPU paylaÅŸÄ±mlÄ±)"},
    {t:"CUDA ortam deÄŸiÅŸkenlerini ayarla",c:"echo 'export CUDA_HOME=/usr/local/cuda\\nexport PATH=$CUDA_HOME/bin:$PATH\\nexport LD_LIBRARY_PATH=$CUDA_HOME/lib64:$LD_LIBRARY_PATH' >> ~/.bashrc && source ~/.bashrc"},
  ]},
  {name:"ğŸ“¦ OpenClaw Kurulumu",tag:"AGENT",tc:"#00e68a",tasks:[
    {t:"OpenClaw'u global kur",c:"npm install -g openclaw"},
    {t:"Versiyonu doÄŸrula",c:"openclaw --version"},
    {t:"BaÅŸlangÄ±Ã§ sihirbazÄ±nÄ± Ã§alÄ±ÅŸtÄ±r",c:"openclaw onboard"},
    {t:"Daemon (7/24) modunu aktifleÅŸtir",c:"openclaw onboard --install-daemon"},
    {t:"OpenClaw servisinin Ã§alÄ±ÅŸtÄ±ÄŸÄ±nÄ± doÄŸrula",c:"systemctl status openclaw || openclaw status"},
  ]},
  {name:"ğŸ—„ï¸ Redis (Kuyruk & Cache â€” Faz 2+ iÃ§in)",tag:"VERÄ°TABANI",tc:"#ff5c6e",tasks:[
    {t:"Redis server kur",c:"sudo apt install -y redis-server"},
    {t:"Redis'i baÅŸlat ve otomatik baÅŸlamayÄ± aktifleÅŸtir",c:"sudo systemctl enable redis-server && sudo systemctl start redis-server"},
    {t:"BaÄŸlantÄ± testi",c:"redis-cli ping â†’ PONG dÃ¶nmeli"},
  ]},
  {name:"ğŸ—ƒï¸ SQLite & PostgreSQL (Log & Audit)",tag:"VERÄ°TABANI",tc:"#ff5c6e",tasks:[
    {t:"SQLite doÄŸrula (genelde yÃ¼klÃ¼)",c:"sqlite3 --version"},
    {t:"PostgreSQL kur (Faz 3 audit DB iÃ§in â€” ÅŸimdi opsiyonel)",c:"sudo apt install -y postgresql postgresql-client"},
    {t:"PostgreSQL'i baÅŸlat",c:"sudo systemctl enable postgresql && sudo systemctl start postgresql"},
    {t:"Test: psql baÄŸlantÄ±sÄ±",c:"sudo -u postgres psql -c 'SELECT version();'"},
  ]},
  {name:"ğŸŒ Tailscale (Uzaktan EriÅŸim)",tag:"AÄ",tc:"#4d94ff",tasks:[
    {t:"Tailscale kur",c:"curl -fsSL https://tailscale.com/install.sh | sh"},
    {t:"Tailscale'i aktifleÅŸtir",c:"sudo tailscale up"},
    {t:"Her iki Spark'ta da kur ve aynÄ± aÄŸa baÄŸla",c:"Spark #1 ve #2'de tekrarla"},
    {t:"Tailscale SSH'Ä± aktifleÅŸtir (opsiyonel)",c:"sudo tailscale up --ssh"},
    {t:"Tailscale Ã¼zerinden eriÅŸimi doÄŸrula",c:"tailscale status â†’ her iki Spark gÃ¶rÃ¼nmeli"},
  ]},
  {name:"ğŸ“Š Grafana (Faz 3+ Dashboard â€” Opsiyonel)",tag:"GÃ–ZLEM",tc:"#ffb84d",tasks:[
    {t:"Grafana repo ekle ve kur",c:"sudo apt install -y apt-transport-https && wget -q -O - https://apt.grafana.com/gpg.key | sudo gpg --dearmor -o /usr/share/keyrings/grafana.gpg && echo 'deb [signed-by=/usr/share/keyrings/grafana.gpg] https://apt.grafana.com stable main' | sudo tee /etc/apt/sources.list.d/grafana.list && sudo apt update && sudo apt install -y grafana"},
    {t:"Grafana'yÄ± baÅŸlat",c:"sudo systemctl enable grafana-server && sudo systemctl start grafana-server"},
    {t:"Web arayÃ¼zÃ¼ne eriÅŸ",c:"http://<spark-ip>:3000 â†’ admin/admin ile giriÅŸ"},
  ]},
  {name:"ğŸ§° GeliÅŸtirme AraÃ§larÄ± (Linter & Test)",tag:"DEV",tc:"#b08cff",tasks:[
    {t:"Python linter (ruff) kur",c:"pip install --break-system-packages ruff mypy"},
    {t:"Ruff Ã§alÄ±ÅŸtÄ±ÄŸÄ±nÄ± doÄŸrula",c:"ruff --version && ruff check --help"},
    {t:"ESLint kur (JS/TS projeleri iÃ§in)",c:"npm install -g eslint typescript"},
    {t:"ESLint doÄŸrula",c:"eslint --version"},
  ]},
];

// â•â•â• STATE â•â•â•
let tab="p0";
let checked=new Set();
let collapsed=new Set();
const LS_KEY="dsx-coding-v22";
try{const s=JSON.parse(localStorage.getItem(LS_KEY));if(s){checked=new Set(s.checked||[]);collapsed=new Set(s.collapsed||[]);tab=s.tab||"prereqs";}}catch(e){}
function save(){try{localStorage.setItem(LS_KEY,JSON.stringify({checked:[...checked],collapsed:[...collapsed],tab}));}catch(e){}}

function setTab(t){tab=t;save();R();}
function togTask(k){checked.has(k)?checked.delete(k):checked.add(k);save();R();}
function togTrack(k){collapsed.has(k)?collapsed.delete(k):collapsed.add(k);save();R();}

// â•â•â• RENDER â•â•â•
function R(){
  const app=document.getElementById('app');
  app.innerHTML=`
    <div class="hero">
      <div class="chip"><span class="pulse"></span>MÃ¼hendislik PlanÄ± v2.2</div>
      <h1>Dual DGX Spark â€” Coding Agent</h1>
      <p>vLLM inference â€¢ OpenClaw orkestrasyon â€¢ Deterministik governance â€¢ Oto-dÃ¼zeltme derleme dÃ¶ngÃ¼sÃ¼</p>
      <div class="hero-tags">
        <span class="hero-tag">ğŸ“ 2Ã— DGX Spark (128 GB)</span>
        <span class="hero-tag">ğŸ”§ vLLM NGC 26.01</span>
        <span class="hero-tag">ğŸ—ï¸ ARM64 / SM121</span>
        <span class="hero-tag">âš ï¸ enforce-eager</span>
      </div>
    </div>
    <div class="specs">
      ${[{e:"ğŸ§ ",v:"128 GB",l:"Spark BaÅŸÄ±na"},{e:"ğŸ’¾",v:"119 GB",l:"KullanÄ±labilir"},{e:"âš¡",v:"SM121",l:"Compute"},{e:"ğŸ”—",v:"200 GbE",l:"BaÄŸlantÄ±"},{e:"ğŸ”§",v:"CUDA 13",l:"Toolkit"},{e:"ğŸ—ï¸",v:"ARM64",l:"Mimari"}].map(s=>`<div class="spec"><div class="emoji">${s.e}</div><div class="val">${s.v}</div><div class="lbl">${s.l}</div></div>`).join('')}
    </div>
    <div class="nav">
      <button class="${tab==='prereqs'?'on':''}" onclick="setTab('prereqs')">ğŸ“¦ Ã–n Gereksinimler</button>
      ${P.map(p=>`<button class="${tab==='p'+p.id?'on':''}" onclick="setTab('p${p.id}')">${p.emoji} Faz ${p.id}</button>`).join('')}
      <button class="${tab==='models'?'on':''}" onclick="setTab('models')">ğŸ¤– Modeller</button>
    </div>
    ${tab==='prereqs'?renderPrereqs():''}
    ${tab==='models'?renderModels():''}
    ${P.map(p=>tab==='p'+p.id?renderPhase(p):'').join('')}
  `;
}

function renderPrereqs(){
  let tot=0,don=0;
  PREREQS.forEach(tr=>{tot+=tr.tasks.length;tr.tasks.forEach((_,i)=>{if(checked.has('pre-'+tr.name+'-'+i))don++;});});
  const pct=tot>0?Math.round(don/tot*100):0;

  return '<div class="sec vis">'+
    '<div class="ph-hdr">'+
      '<div class="ph-icon" style="background:#ff6eb415;font-size:22px">ğŸ“¦</div>'+
      '<div class="ph-info"><h2 style="color:#ff6eb4">Ã–n Gereksinimler â€” YazÄ±lÄ±m Kurulumu</h2><p>DGX Spark Ã¼zerinde tÃ¼m fazlar iÃ§in gerekli araÃ§larÄ±n kurulum rehberi. Her iki Spark\'ta Ã§alÄ±ÅŸtÄ±rÄ±lmalÄ±.</p></div>'+
    '</div>'+
    '<div class="prog-wrap">'+
      '<div class="prog-bar"><div class="prog-fill" style="width:'+pct+'%;background:#ff6eb4"></div></div>'+
      '<div class="prog-text" style="color:#ff6eb4">'+don+'/'+tot+'</div>'+
    '</div>'+
    '<div class="warn">'+
      '<h4>âš ï¸ DGX Spark\'a Ã–zgÃ¼ Notlar</h4>'+
      '<p>ğŸ—ï¸ <strong>ARM64 mimari:</strong> TÃ¼m paketler <code>aarch64</code> uyumlu olmalÄ±. x86_64 binary\'ler Ã§alÄ±ÅŸmaz.</p>'+
      '<p style="margin-top:4px">ğŸ”§ <strong>DGX OS:</strong> Ubuntu 24.04 tabanlÄ±. CUDA 13 ve NVIDIA driver\'larÄ± Ã¶nceden yÃ¼klÃ¼ gelir.</p>'+
      '<p style="margin-top:4px">ğŸ“¦ <strong>pip:</strong> Sistem Python\'una kurarken <code>--break-system-packages</code> flag\'Ä± gerekli.</p>'+
      '<p style="margin-top:4px">ğŸ”„ <strong>Her iki Spark\'ta Ã§alÄ±ÅŸtÄ±r:</strong> Bu adÄ±mlarÄ± Spark #1 ve Spark #2\'de ayrÄ± ayrÄ± uygula.</p>'+
    '</div>'+
    PREREQS.map(function(tr,ti){
      var tKey='t-pre-'+ti;
      var col=collapsed.has(tKey);
      var tDone=0; tr.tasks.forEach(function(_,i){if(checked.has('pre-'+tr.name+'-'+i))tDone++;});
      return '<div class="track">'+
        '<div class="track-head" onclick="togTrack(\''+tKey+'\')">'+
          '<span class="left">'+tr.name+'</span>'+
          '<span class="counter">'+tDone+'/'+tr.tasks.length+'</span>'+
          '<span class="tag" style="background:'+tr.tc+'12;color:'+tr.tc+';border:1px solid '+tr.tc+'30">'+tr.tag+'</span>'+
          '<span class="chevron">'+(col?'â–¸':'â–¾')+'</span>'+
        '</div>'+
        '<div class="track-body '+(col?'hide':'')+'">'+
          tr.tasks.map(function(task,i){
            var k='pre-'+tr.name+'-'+i;
            var d=checked.has(k);
            return '<div class="task '+(d?'done':'')+'" onclick="togTask(\''+k+'\')">'+
              '<div class="cb">'+(d?'âœ“':'')+'</div>'+
              '<div class="task-body">'+
                '<div class="task-text">'+task.t+'</div>'+
                '<div class="task-cmd">'+task.c+'</div>'+
              '</div>'+
            '</div>';
          }).join('')+
        '</div>'+
      '</div>';
    }).join('')+
    '<div class="qs">'+
      '<h3>âš¡ HÄ±zlÄ± Kontrol â€” Her Åey Kuruldu mu?</h3>'+
      '<div class="qs-cmd"><code># TÃ¼m gereksinimleri tek seferde kontrol et:\necho "=== OS ===" &amp;&amp; cat /etc/os-release | grep PRETTY\necho "=== CUDA ===" &amp;&amp; nvcc --version | grep release\necho "=== GPU ===" &amp;&amp; nvidia-smi | head -4\necho "=== Docker ===" &amp;&amp; docker --version\necho "=== NVIDIA Toolkit ===" &amp;&amp; nvidia-ctk --version\necho "=== Python ===" &amp;&amp; python3 --version\necho "=== Node.js ===" &amp;&amp; node --version\necho "=== npm ===" &amp;&amp; npm --version\necho "=== OpenClaw ===" &amp;&amp; openclaw --version 2&gt;/dev/null || echo "kurulmamÄ±ÅŸ"\necho "=== Redis ===" &amp;&amp; redis-cli ping 2&gt;/dev/null || echo "kurulmamÄ±ÅŸ"\necho "=== Bellek ===" &amp;&amp; free -h | grep Mem\necho "=== Mimari ===" &amp;&amp; uname -m</code></div>'+
      '<div class="tip">ğŸ’¡ Bu script\'i her iki Spark\'ta Ã§alÄ±ÅŸtÄ±r. TÃ¼m Ã§Ä±ktÄ±lar beklenen deÄŸerleri gÃ¶steriyorsa Faz 0\'a geÃ§ebilirsin.</div>'+
    '</div>'+
    '<div class="success">'+
      '<h4>âœ… Ã–n Gereksinimler Tamamlanma KoÅŸullarÄ±</h4>'+
      '<div class="si"><span class="arr" style="color:var(--grn)">âœ“</span>Python 3.12+, Node.js 22+, Docker 24+ kurulu</div>'+
      '<div class="si"><span class="arr" style="color:var(--grn)">âœ“</span>NVIDIA Container Toolkit GPU passthrough Ã§alÄ±ÅŸÄ±yor</div>'+
      '<div class="si"><span class="arr" style="color:var(--grn)">âœ“</span>NGC vLLM container Ã§ekildi (nvcr.io/nvidia/vllm:26.01-py3)</div>'+
      '<div class="si"><span class="arr" style="color:var(--grn)">âœ“</span>OpenClaw kurulu ve daemon Ã§alÄ±ÅŸÄ±yor</div>'+
      '<div class="si"><span class="arr" style="color:var(--grn)">âœ“</span>Redis Ã§alÄ±ÅŸÄ±yor (ping â†’ PONG)</div>'+
      '<div class="si"><span class="arr" style="color:var(--grn)">âœ“</span>Tailscale ile uzaktan eriÅŸim saÄŸlandÄ±</div>'+
      '<div class="si"><span class="arr" style="color:var(--grn)">âœ“</span>Her iki Spark\'ta tÃ¼m adÄ±mlar tekrarlandÄ±</div>'+
    '</div>'+
  '</div>';
}

function renderPhase(p){
  // count
  let tot=0,don=0;
  p.tracks.forEach(tr=>{tot+=tr.tasks.length;tr.tasks.forEach((_,i)=>{if(checked.has(`${p.id}-${tr.name}-${i}`))don++;});});
  const pct=tot>0?Math.round(don/tot*100):0;

  return `<div class="sec vis">
    <div class="ph-hdr">
      <div class="ph-icon" style="background:${p.color}15">${p.emoji}</div>
      <div class="ph-info"><h2 style="color:${p.color}">Faz ${p.id} â€” ${p.title}</h2><p>${p.obj}</p></div>
    </div>
    <div class="prog-wrap">
      <div class="prog-bar"><div class="prog-fill" style="width:${pct}%;background:${p.color}"></div></div>
      <div class="prog-text" style="color:${p.color}">${don}/${tot}</div>
    </div>
    <div class="spark-grid">
      <div class="spark-card" style="border-color:${p.color}35">
        <h4>ğŸŸ¢ Spark #1<span class="badge">128 GB</span></h4>
        ${p.s1.map(s=>`<div class="si"><span class="arr" style="color:${p.color}">â†’</span>${s}</div>`).join('')}
      </div>
      <div class="spark-card" style="border-color:var(--brd)">
        <h4>ğŸ”µ Spark #2<span class="badge">128 GB</span></h4>
        ${p.s2.map(s=>`<div class="si"><span class="arr" style="color:var(--t3)">â†’</span>${s}</div>`).join('')}
      </div>
    </div>

    ${p.tracks.map((tr,ti)=>{
      const tKey=`t-${p.id}-${ti}`;
      const col=collapsed.has(tKey);
      let tDone=0; tr.tasks.forEach((_,i)=>{if(checked.has(`${p.id}-${tr.name}-${i}`))tDone++;});
      return `<div class="track">
        <div class="track-head" onclick="togTrack('${tKey}')">
          <span class="left">${tr.name}</span>
          <span class="counter">${tDone}/${tr.tasks.length}</span>
          <span class="tag" style="background:${tr.tc}12;color:${tr.tc};border:1px solid ${tr.tc}30">${tr.tag}</span>
          <span class="chevron">${col?'â–¸':'â–¾'}</span>
        </div>
        <div class="track-body ${col?'hide':''}">
          ${tr.tasks.map((task,i)=>{
            const k=`${p.id}-${tr.name}-${i}`;
            const d=checked.has(k);
            return `<div class="task ${d?'done':''}" onclick="togTask('${k}')">
              <div class="cb">${d?'âœ“':''}</div>
              <div class="task-body">
                <div class="task-text">${task.t}</div>
                <div class="task-cmd">${task.c}</div>
              </div>
            </div>`;
          }).join('')}
        </div>
      </div>`;
    }).join('')}

    <div class="track">
      <div class="track-head" onclick="togTrack('gov-${p.id}')">
        <span class="left">ğŸ›¡ï¸ Governance Parametreleri</span>
        <span class="tag" style="background:#ff5c6e12;color:#ff5c6e;border:1px solid #ff5c6e30">GOVERNANCE</span>
        <span class="chevron">${collapsed.has('gov-'+p.id)?'â–¸':'â–¾'}</span>
      </div>
      <div class="track-body ${collapsed.has('gov-'+p.id)?'hide':''}">
        <div style="padding:10px 16px">
          <div class="gov">
            ${Object.entries(p.gov).map(([k,v])=>`<div class="gov-cell"><div class="gl">${k}</div><div class="gv">${v}</div></div>`).join('')}
          </div>
        </div>
      </div>
    </div>

    <div class="success">
      <h4>âœ… BaÅŸarÄ± Kriterleri â€” Faz ${p.id} Tamamlanma KoÅŸullarÄ±</h4>
      ${p.success.map(s=>`<div class="si"><span class="arr" style="color:var(--grn)">âœ“</span>${s}</div>`).join('')}
    </div>

    ${p.id===0?`<div class="qs"><h3>âš¡ Faz 0 HÄ±zlÄ± BaÅŸlangÄ±Ã§</h3>
      <div class="qs-cmd"><code># Her iki Spark'ta Ã§alÄ±ÅŸtÄ±r:\nnvcc --version\nnvidia-smi\nfree -h\nuname -m\ndocker --version</code></div>
      <div class="qs-cmd"><code># NGC vLLM container Ã§ek:\ndocker pull nvcr.io/nvidia/vllm:26.01-py3</code></div>
      <div class="qs-cmd"><code># Smoke test:\ndocker run --rm -it --gpus all --shm-size=16g \\\n  -p 8000:8000 nvcr.io/nvidia/vllm:26.01-py3 \\\n  vllm serve facebook/opt-125m --enforce-eager</code></div>
      <div class="tip">ğŸ’¡ Her iki Spark'ta baÄŸÄ±msÄ±z olarak Ã§alÄ±ÅŸtÄ±r. DaÄŸÄ±tÄ±k mod bu fazda yok.</div>
    </div>`:''}

    ${p.id===1?`<div class="qs"><h3>âš¡ Faz 1 HÄ±zlÄ± BaÅŸlangÄ±Ã§ â€” 3 Model SÄ±rayla</h3>
      <div class="qs-cmd"><code># 1. Router baÅŸlat (en kÃ¼Ã§Ã¼k â€” saÄŸlÄ±k kontrolÃ¼ iÃ§in)\ndocker run -d --gpus all --name vllm-router \\\n  -p 8001:8000 nvcr.io/nvidia/vllm:26.01-py3 \\\n  vllm serve meta-llama/Llama-3.1-8B-Instruct \\\n  --enforce-eager --gpu-memory-utilization 0.08</code></div>
      <div class="qs-cmd"><code># 2. Coder baÅŸlat\ndocker run -d --gpus all --name vllm-coder \\\n  -p 8003:8000 nvcr.io/nvidia/vllm:26.01-py3 \\\n  vllm serve Qwen/Qwen3-Coder-30B-Instruct \\\n  --enforce-eager --gpu-memory-utilization 0.35</code></div>
      <div class="qs-cmd"><code># 3. Reasoning baÅŸlat (en son)\ndocker run -d --gpus all --name vllm-reasoning \\\n  -p 8002:8000 nvcr.io/nvidia/vllm:26.01-py3 \\\n  vllm serve Qwen/Qwen3-32B \\\n  --enforce-eager --gpu-memory-utilization 0.35</code></div>
      <div class="qs-cmd"><code># 4. Bellek kontrol:\nfree -h  # â‰¥20 GB boÅŸ olmalÄ±</code></div>
      <div class="tip">ğŸ’¡ SÄ±ralama Ã¶nemli: Router â†’ Coder â†’ Reasoning. Bellekte en kÃ¼Ã§Ã¼kten baÅŸla.</div>
    </div>`:''}
  </div>`;
}

function renderModels(){
  const tot=RI.reduce((a,r)=>a+r.gb,0);
  return `<div class="sec vis">
    <div class="ph-hdr">
      <div class="ph-icon" style="background:#00e68a15;font-size:22px">ğŸ¤–</div>
      <div class="ph-info"><h2>Model Stratejisi</h2><p>ÃœÃ§ katmanlÄ± lokal inference + bulut fallback. TÃ¼mÃ¼ vLLM (OpenAI-uyumlu API).</p></div>
    </div>
    <div class="warn">
      <h4>âš ï¸ DGX Spark vLLM KÄ±sÄ±tlamalarÄ±</h4>
      <p>ğŸ”§ <strong>enforce-eager zorunlu:</strong> Triton sm_121 desteÄŸi henÃ¼z olgun deÄŸil â†’ ~%20-30 daha yavaÅŸ. NGC 26.01-py3 container Ã¶nerilir.</p>
      <p style="margin-top:4px">ğŸ’¾ <strong>UMA bellek:</strong> GPU+CPU aynÄ± 128 GB paylaÅŸÄ±r. OOM = sistem zombie (SSH donar). <code>free -h</code> ile takip et.</p>
    </div>
    <table class="tbl">
      <thead><tr><th></th><th>Tier</th><th>Rol</th><th>Model</th><th>RAM</th><th>HÄ±z</th><th>Context</th><th>Port</th></tr></thead>
      <tbody>${MT.map(m=>`<tr><td>${m.emoji}</td><td><strong>${m.tier}</strong></td><td>${m.role}</td><td class="mono" style="color:${m.c}">${m.model}</td><td>${m.ram}</td><td>${m.spd}</td><td>${m.ctx}</td><td class="mono">${m.port}</td></tr>`).join('')}</tbody>
    </table>
    <div class="track" style="margin-top:14px">
      <div class="track-head" onclick="togTrack('ram')"><span class="left">ğŸ’¾ Spark #1 Bellek BÃ¼tÃ§esi (119 GB)</span><span class="tag" style="background:#ffb84d12;color:#ffb84d;border:1px solid #ffb84d30">RAM</span><span class="chevron">${collapsed.has('ram')?'â–¸':'â–¾'}</span></div>
      <div class="track-body ${collapsed.has('ram')?'hide':''}">
        <div style="padding:12px 16px">
          ${RI.map(r=>`<div class="ram-row"><div class="ram-lbl">${r.l}</div><div class="ram-bg"><div class="ram-fill" style="width:${Math.max(r.gb/119*100,4)}%;background:${r.c}"><span>${r.gb} GB</span></div></div></div>`).join('')}
          <div style="margin-top:8px;font-size:11px;color:var(--t3)">Toplam: ${tot} GB / 119 GB ${tot<=119?'<span style="color:#00e68a">âœ… BÃ¼tÃ§e dahilinde</span>':'<span style="color:#ff5c6e">âš ï¸ AÅŸÄ±m</span>'}</div>
          <div class="danger" style="margin-top:10px">
            <h4>âš ï¸ UMA Bellek UyarÄ±sÄ±</h4>
            <div class="si"><span class="arr" style="color:#ff5c6e">!</span>OOM temiz CUDA hatasÄ± ÃœRETMEZ â€” sistem zombie olur (SSH donar)</div>
            <div class="si"><span class="arr" style="color:#ff5c6e">!</span>Her zaman â‰¥8 GB headroom bÄ±rak</div>
            <div class="si"><span class="arr" style="color:#ff5c6e">!</span><code>free -h</code> kullan â€” <code>nvidia-smi</code> UMA'da N/A gÃ¶sterir</div>
          </div>
        </div>
      </div>
    </div>
    <div class="track" style="margin-top:8px">
      <div class="track-head" onclick="togTrack('load')"><span class="left">ğŸ“‹ Model YÃ¼kleme SÄ±rasÄ±</span><span class="tag" style="background:#4d94ff12;color:#4d94ff;border:1px solid #4d94ff30">PROSEDÃœR</span><span class="chevron">${collapsed.has('load')?'â–¸':'â–¾'}</span></div>
      <div class="track-body ${collapsed.has('load')?'hide':''}">
        <div style="padding:12px 16px">
          <div class="si"><span class="arr" style="color:#00e68a">1</span>Router (Llama 8B) â€” en kÃ¼Ã§Ã¼k, saÄŸlÄ±k kontrolÃ¼ iÃ§in</div>
          <div class="si"><span class="arr" style="color:#00e68a">2</span>Coder (Qwen Coder 30B) â€” birincil iÅŸ yÃ¼kÃ¼</div>
          <div class="si"><span class="arr" style="color:#00e68a">3</span>Reasoning (Qwen 32B) â€” en son, daha az kullanÄ±lÄ±r</div>
          <div class="si"><span class="arr" style="color:#ffb84d">4</span>Hepsi Ã§alÄ±ÅŸÄ±rken: <code>free -h</code> â†’ â‰¥8 GB boÅŸ olmalÄ±</div>
          <div class="si"><span class="arr" style="color:#ff5c6e">5</span>Yetersizse: <code>--max-model-len</code> veya <code>--gpu-memory-utilization</code> azalt</div>
        </div>
      </div>
    </div>
  </div>`;
}

R();
</script>
</body>
</html>
